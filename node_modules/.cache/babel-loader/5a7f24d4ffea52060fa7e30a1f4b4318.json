{"ast":null,"code":"function _typeof(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { dataURItoBlob, shouldRender } from \"../../utils\";\n\nfunction addNameToDataURL(dataURL, name) {\n  return dataURL.replace(\";base64\", \";name=\".concat(encodeURIComponent(name), \";base64\"));\n}\n\nfunction processFile(file) {\n  var name = file.name,\n      size = file.size,\n      type = file.type;\n  return new Promise(function (resolve, reject) {\n    var reader = new window.FileReader();\n    reader.onerror = reject;\n\n    reader.onload = function (event) {\n      resolve({\n        dataURL: addNameToDataURL(event.target.result, name),\n        name: name,\n        size: size,\n        type: type\n      });\n    };\n\n    reader.readAsDataURL(file);\n  });\n}\n\nfunction processFiles(files) {\n  return Promise.all([].map.call(files, processFile));\n}\n\nfunction FilesInfo(props) {\n  var filesInfo = props.filesInfo;\n\n  if (filesInfo.length === 0) {\n    return null;\n  }\n\n  return React.createElement(\"ul\", {\n    className: \"file-info\"\n  }, filesInfo.map(function (fileInfo, key) {\n    var name = fileInfo.name,\n        size = fileInfo.size,\n        type = fileInfo.type;\n    return React.createElement(\"li\", {\n      key: key\n    }, React.createElement(\"strong\", null, name), \" (\", type, \", \", size, \" bytes)\");\n  }));\n}\n\nfunction extractFileInfo(dataURLs) {\n  return dataURLs.filter(function (dataURL) {\n    return typeof dataURL !== \"undefined\";\n  }).map(function (dataURL) {\n    var _dataURItoBlob = dataURItoBlob(dataURL),\n        blob = _dataURItoBlob.blob,\n        name = _dataURItoBlob.name;\n\n    return {\n      name: name,\n      size: blob.size,\n      type: blob.type\n    };\n  });\n}\n\nvar FileWidget = /*#__PURE__*/function (_Component) {\n  _inherits(FileWidget, _Component);\n\n  function FileWidget(props) {\n    var _this;\n\n    _classCallCheck(this, FileWidget);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(FileWidget).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (event) {\n      var _this$props = _this.props,\n          multiple = _this$props.multiple,\n          onChange = _this$props.onChange;\n      processFiles(event.target.files).then(function (filesInfo) {\n        var state = {\n          values: filesInfo.map(function (fileInfo) {\n            return fileInfo.dataURL;\n          }),\n          filesInfo: filesInfo\n        };\n\n        _this.setState(state, function () {\n          if (multiple) {\n            onChange(state.values);\n          } else {\n            onChange(state.values[0]);\n          }\n        });\n      });\n    });\n\n    var value = props.value;\n    var values = Array.isArray(value) ? value : [value];\n    _this.state = {\n      values: values,\n      filesInfo: extractFileInfo(values)\n    };\n    return _this;\n  }\n\n  _createClass(FileWidget, [{\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState) {\n      return shouldRender(this, nextProps, nextState);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props2 = this.props,\n          multiple = _this$props2.multiple,\n          id = _this$props2.id,\n          readonly = _this$props2.readonly,\n          disabled = _this$props2.disabled,\n          autofocus = _this$props2.autofocus,\n          options = _this$props2.options;\n      var filesInfo = this.state.filesInfo;\n      return React.createElement(\"div\", null, React.createElement(\"p\", null, React.createElement(\"input\", {\n        ref: function ref(_ref) {\n          return _this2.inputRef = _ref;\n        },\n        id: id,\n        type: \"file\",\n        disabled: readonly || disabled,\n        onChange: this.onChange,\n        defaultValue: \"\",\n        autoFocus: autofocus,\n        multiple: multiple,\n        accept: options.accept\n      })), React.createElement(FilesInfo, {\n        filesInfo: filesInfo\n      }));\n    }\n  }]);\n\n  return FileWidget;\n}(Component);\n\nFileWidget.defaultProps = {\n  autofocus: false\n};\n\nif (process.env.NODE_ENV !== \"production\") {\n  FileWidget.propTypes = {\n    multiple: PropTypes.bool,\n    value: PropTypes.oneOfType([PropTypes.string, PropTypes.arrayOf(PropTypes.string)]),\n    autofocus: PropTypes.bool\n  };\n}\n\nexport default FileWidget;","map":{"version":3,"mappings":"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","names":["React","Component","PropTypes","dataURItoBlob","shouldRender","addNameToDataURL","dataURL","name","replace","encodeURIComponent","processFile","file","size","type","Promise","resolve","reject","reader","window","FileReader","onerror","onload","event","target","result","readAsDataURL","processFiles","files","all","map","call","FilesInfo","props","filesInfo","length","className","fileInfo","key","extractFileInfo","dataURLs","filter","blob","FileWidget","_classCallCheck","_this","_defineProperty","multiple","onChange","then","state","values","setState","value","Array","isArray","nextProps","nextState","id","readonly","disabled","autofocus","options","ref","_this2","inputRef","defaultValue","autoFocus","accept","defaultProps","process","env","NODE_ENV","propTypes","bool","oneOfType","string","arrayOf"],"sources":["/core/src/components/widgets/FileWidget.js"],"sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport { dataURItoBlob, shouldRender } from \"../../utils\";\n\nfunction addNameToDataURL(dataURL, name) {\n  return dataURL.replace(\";base64\", `;name=${encodeURIComponent(name)};base64`);\n}\n\nfunction processFile(file) {\n  const { name, size, type } = file;\n  return new Promise((resolve, reject) => {\n    const reader = new window.FileReader();\n    reader.onerror = reject;\n    reader.onload = event => {\n      resolve({\n        dataURL: addNameToDataURL(event.target.result, name),\n        name,\n        size,\n        type,\n      });\n    };\n    reader.readAsDataURL(file);\n  });\n}\n\nfunction processFiles(files) {\n  return Promise.all([].map.call(files, processFile));\n}\n\nfunction FilesInfo(props) {\n  const { filesInfo } = props;\n  if (filesInfo.length === 0) {\n    return null;\n  }\n  return (\n    <ul className=\"file-info\">\n      {filesInfo.map((fileInfo, key) => {\n        const { name, size, type } = fileInfo;\n        return (\n          <li key={key}>\n            <strong>{name}</strong> ({type}, {size} bytes)\n          </li>\n        );\n      })}\n    </ul>\n  );\n}\n\nfunction extractFileInfo(dataURLs) {\n  return dataURLs\n    .filter(dataURL => typeof dataURL !== \"undefined\")\n    .map(dataURL => {\n      const { blob, name } = dataURItoBlob(dataURL);\n      return {\n        name: name,\n        size: blob.size,\n        type: blob.type,\n      };\n    });\n}\n\nclass FileWidget extends Component {\n  constructor(props) {\n    super(props);\n    const { value } = props;\n    const values = Array.isArray(value) ? value : [value];\n    this.state = { values, filesInfo: extractFileInfo(values) };\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return shouldRender(this, nextProps, nextState);\n  }\n\n  onChange = event => {\n    const { multiple, onChange } = this.props;\n    processFiles(event.target.files).then(filesInfo => {\n      const state = {\n        values: filesInfo.map(fileInfo => fileInfo.dataURL),\n        filesInfo,\n      };\n      this.setState(state, () => {\n        if (multiple) {\n          onChange(state.values);\n        } else {\n          onChange(state.values[0]);\n        }\n      });\n    });\n  };\n\n  render() {\n    const { multiple, id, readonly, disabled, autofocus, options } = this.props;\n    const { filesInfo } = this.state;\n    return (\n      <div>\n        <p>\n          <input\n            ref={ref => (this.inputRef = ref)}\n            id={id}\n            type=\"file\"\n            disabled={readonly || disabled}\n            onChange={this.onChange}\n            defaultValue=\"\"\n            autoFocus={autofocus}\n            multiple={multiple}\n            accept={options.accept}\n          />\n        </p>\n        <FilesInfo filesInfo={filesInfo} />\n      </div>\n    );\n  }\n}\n\nFileWidget.defaultProps = {\n  autofocus: false,\n};\n\nif (process.env.NODE_ENV !== \"production\") {\n  FileWidget.propTypes = {\n    multiple: PropTypes.bool,\n    value: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.arrayOf(PropTypes.string),\n    ]),\n    autofocus: PropTypes.bool,\n  };\n}\n\nexport default FileWidget;\n"]},"metadata":{},"sourceType":"module"}